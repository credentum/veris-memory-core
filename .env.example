# Veris Memory - Environment Configuration
# Copy this file to .env and set your values

# ===================
# Required: Passwords
# ===================
NEO4J_PASSWORD=your_neo4j_password_here
REDIS_PASSWORD=your_redis_password_here

# ===================
# Optional: API Auth
# ===================
# Set AUTH_REQUIRED=true to require API keys
AUTH_REQUIRED=false

# API Key Format: VERIS_API_KEY_{NAME}=key:user_id:role:is_agent
# - key: The actual API key (e.g., vmk_herald_xxx)
# - user_id: Namespace/team identifier (e.g., herald, research)
# - role: admin | writer | reader | guest
# - is_agent: true | false
#
# Examples:
# VERIS_API_KEY_MCP=vmk_mcp_xxx:mcp_server:writer:true
# VERIS_API_KEY_HERALD=vmk_herald_xxx:herald:writer:true
# VERIS_API_KEY_RESEARCH=vmk_research_xxx:research:writer:true
# VERIS_API_KEY_VOICEBOT=vmk_voicebot_xxx:voicebot:writer:true
# VERIS_API_KEY_SENTINEL=vmk_sentinel_xxx:sentinel:reader:true
#
# Client usage: X-API-Key header with just the key part (before first colon)
# Example: curl -H "X-API-Key: vmk_herald_xxx" ...
VERIS_API_KEY_MCP=

# ===================
# Optional: Logging
# ===================
LOG_LEVEL=info
ENVIRONMENT=development

# ===================
# Embedding Configuration
# ===================
# Provider options:
#   - "local": Uses sentence-transformers (all-MiniLM-L6-v2, 384D)
#   - "openrouter": Uses OpenRouter API (text-embedding-3-large truncated to 384D via Matryoshka)
#
# Matryoshka Representation Learning (MRL) allows truncating text-embedding-3-large
# from 3072D to 384D while preserving ~95% quality. No Qdrant migration needed.
EMBEDDING_PROVIDER=local

# Embedding dimensions (default: 384 - unchanged for both providers)
EMBEDDING_DIM=384
EMBEDDING_DIMENSIONS=384

# Model selection:
#   - For local: sentence-transformers model name
#   - For openrouter: OpenRouter model path (e.g., openai/text-embedding-3-large)
EMBEDDING_MODEL=all-MiniLM-L6-v2

# OpenRouter API key (required when EMBEDDING_PROVIDER=openrouter)
# Get a key at https://openrouter.ai/keys
# Note: OPENROUTER_API_KEY is also used by HyDE if configured
QDRANT_COLLECTION_NAME=context_embeddings

# ===================
# HyDE (Hypothetical Document Embeddings)
# ===================
# Generates hypothetical documents from queries for better semantic matching
# Requires OPENROUTER_API_KEY or OPENAI_API_KEY
HYDE_ENABLED=true
HYDE_API_PROVIDER=openrouter
HYDE_MODEL=meta-llama/llama-2-7b
HYDE_BASE_URL=https://openrouter.ai/api/v1
HYDE_MAX_TOKENS=150
HYDE_TEMPERATURE=0.7
HYDE_CACHE_ENABLED=true
HYDE_LLM_TIMEOUT=30.0
OPENROUTER_API_KEY=

# ===================
# Cross-Encoder Reranker
# ===================
# Re-ranks initial retrieval results for better relevance ordering
CROSS_ENCODER_RERANKER_ENABLED=true
CROSS_ENCODER_TOP_K=50
CROSS_ENCODER_RETURN_K=10
CROSS_ENCODER_FALLBACK_THRESHOLD=-5.0

# ===================
# Sparse Embeddings / Hybrid Search
# ===================
# Combines dense (semantic) with sparse (BM25) vectors for hybrid retrieval
SPARSE_EMBEDDINGS_ENABLED=true
SPARSE_EMBEDDING_MODEL=Qdrant/bm25

# ===================
# Search Enhancements
# ===================
MQE_ENABLED=true
MQE_NUM_PARAPHRASES=2
MQE_APPLY_FIELD_BOOSTS=true
SEARCH_ENHANCEMENTS_ENABLED=true
SEARCH_ENHANCEMENT_EXACT_MATCH=true
SEARCH_ENHANCEMENT_TYPE_WEIGHTING=true
SEARCH_ENHANCEMENT_RECENCY_DECAY=true
SEARCH_ENHANCEMENT_TECHNICAL_BOOST=true
QUERY_NORMALIZATION_ENABLED=true
QUERY_NORMALIZATION_CONFIDENCE=0.5

# ===================
# Semantic Cache
# ===================
SEMANTIC_CACHE_ENABLED=true
SEMANTIC_CACHE_PRECISION=1
SEMANTIC_CACHE_PREFIX_LENGTH=32

# ===================
# Covenant Mediator (Phase 4)
# ===================
# Memory gating based on novelty and authority
COVENANT_MEDIATOR_ENABLED=false
HIGH_AUTHORITY_BYPASS=8
COVENANT_WEIGHT_THRESHOLD=0.3
TOKEN_NOVELTY_BONUS=0.5
SPARSITY_WEIGHT=0.5

# ===================
# SSL/TLS Configuration (Optional)
# ===================
# Neo4j SSL
# NEO4J_SSL_ENABLED=false
# NEO4J_SSL_CERT=
# NEO4J_SSL_KEY=
# NEO4J_SSL_TRUST=TRUST_SYSTEM_CA_SIGNED_CERTIFICATES

# Qdrant SSL
# QDRANT_SSL_ENABLED=false
# QDRANT_VERIFY_SSL=true
# QDRANT_CA_CERT=
# QDRANT_API_KEY=

# Redis SSL
# REDIS_SSL_ENABLED=false
# REDIS_SSL_CHECK_HOSTNAME=true
# REDIS_SSL_VERIFY_CERTS=true
# REDIS_SSL_CERTFILE=
# REDIS_SSL_KEYFILE=
# REDIS_SSL_CA_CERTS=
# REDIS_SSL_PASSWORD=

# ===================
# Monitoring
# ===================
# JAEGER_ENDPOINT=
